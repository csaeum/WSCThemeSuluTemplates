{#
    Block: wsc-faq
    Einzelner FAQ-Block mit SEO Rich Snippet (schema.org FAQPage)
    Für Accordion-Darstellung: FAQ-Blöcke in den Accordion-Block packen
#}

{% set question = block.question|default('') %}
{% set answer = block.answer|default('') %}
{% set enableRichSnippet = block.enable_rich_snippet|default(true) %}
{% set questionTag = block.question_tag|default('h3') %}
{% set faqStyle = block.faq_style|default('default') %}
{% set questionColor = block.question_color|default('') %}

{# Margin #}
{% set marginTop = block.margin_top|default('mt-3') %}
{% set marginBottom = block.margin_bottom|default('mb-3') %}
{% set marginStart = block.margin_start|default('ms-0') %}
{% set marginEnd = block.margin_end|default('me-0') %}

{# Padding #}
{% set paddingTop = block.padding_top|default('pt-0') %}
{% set paddingBottom = block.padding_bottom|default('pb-0') %}
{% set paddingStart = block.padding_start|default('ps-0') %}
{% set paddingEnd = block.padding_end|default('pe-0') %}

{# Erweiterte Optionen #}
{% set cssClass = block.css_class|default('') %}
{% set htmlId = block.html_id|default('') %}

{# Wrapper-Klassen #}
{% set wrapperClasses = ['faq-item'] %}

{% if faqStyle == 'card' %}
    {% set wrapperClasses = wrapperClasses|merge(['card']) %}
{% elseif faqStyle == 'bordered' %}
    {% set wrapperClasses = wrapperClasses|merge(['border', 'rounded', 'p-3']) %}
{% elseif faqStyle == 'shadow' %}
    {% set wrapperClasses = wrapperClasses|merge(['shadow-sm', 'p-3', 'rounded']) %}
{% endif %}

{% if marginTop != 'mt-0' %}
    {% set wrapperClasses = wrapperClasses|merge([marginTop]) %}
{% endif %}
{% if marginBottom != 'mb-0' %}
    {% set wrapperClasses = wrapperClasses|merge([marginBottom]) %}
{% endif %}
{% if marginStart != 'ms-0' %}
    {% set wrapperClasses = wrapperClasses|merge([marginStart]) %}
{% endif %}
{% if marginEnd != 'me-0' %}
    {% set wrapperClasses = wrapperClasses|merge([marginEnd]) %}
{% endif %}
{% if paddingTop != 'pt-0' %}
    {% set wrapperClasses = wrapperClasses|merge([paddingTop]) %}
{% endif %}
{% if paddingBottom != 'pb-0' %}
    {% set wrapperClasses = wrapperClasses|merge([paddingBottom]) %}
{% endif %}
{% if paddingStart != 'ps-0' %}
    {% set wrapperClasses = wrapperClasses|merge([paddingStart]) %}
{% endif %}
{% if paddingEnd != 'pe-0' %}
    {% set wrapperClasses = wrapperClasses|merge([paddingEnd]) %}
{% endif %}
{% if cssClass is not empty %}
    {% set wrapperClasses = wrapperClasses|merge([cssClass]) %}
{% endif %}

{# Frage-Klassen #}
{% set questionClasses = ['faq-question'] %}
{% if questionColor is not empty %}
    {% set questionClasses = questionClasses|merge([questionColor]) %}
{% endif %}

{# Finale Klassen-Strings #}
{% set wrapperClassString = wrapperClasses|join(' ') %}
{% set questionClassString = questionClasses|join(' ') %}

{% if question is not empty and answer is not empty %}
{# SEO Rich Snippet (JSON-LD) #}
{% if enableRichSnippet %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": {{ question|striptags|json_encode|raw }},
      "acceptedAnswer": {
        "@type": "Answer",
        "text": {{ answer|striptags|json_encode|raw }}
      }
    }
  ]
}
</script>
{% endif %}

{# FAQ Item Rendering #}
<div{% if htmlId is not empty %} id="{{ htmlId }}"{% endif %} class="{{ wrapperClassString }}" itemscope itemtype="https://schema.org/Question">
    {% if faqStyle == 'card' %}
        <div class="card-body">
            <{{ questionTag }} class="{{ questionClassString }}" itemprop="name">{{ question }}</{{ questionTag }}>
            <div class="faq-answer" itemprop="acceptedAnswer" itemscope itemtype="https://schema.org/Answer">
                <div itemprop="text">{{ answer|raw }}</div>
            </div>
        </div>
    {% else %}
        <{{ questionTag }} class="{{ questionClassString }}" itemprop="name">{{ question }}</{{ questionTag }}>
        <div class="faq-answer" itemprop="acceptedAnswer" itemscope itemtype="https://schema.org/Answer">
            <div itemprop="text">{{ answer|raw }}</div>
        </div>
    {% endif %}
</div>
{% endif %}
